# ADK Модуль "application-rocsk-db"

## Назначение модуля
Даннй модуль представляет собой обертку над RocksDB. 
Ключевые компоненты:

1. `RocksDbArraysDao`
2. `RocksDbCollectionDao`
3. `RocksDbPrimitiveDao`
4. `RocksDbValueDao`

RocksDB – гибкое производительное встраиваемое NoSQL хранилище.
Модель данных роксы - key:value.
Основной API, который предоставляет библиотека роксы под Java:

1. put(key, value)
2. get(key)
3. delete(key)
4. merge(key, value)

Во всех случаях key и value является массивом байт. Подобный подход нельзя назвать удобным. Поэтому было решено сделать ряд DAO для работы с роксой.  

1. RocksDbPrimitiveDao - хранит ряд методов для работы с Java примитивами. Каждый примитив хранится в своей "ячейке" роксы под своим ключом.
2. RocksDbCollectionDao - хранит ряд методов для работы с Java коллекциями. Одна коллекция хранится в одной "ячейке". Добавление элементов осуществляется через RocksDB операцию "merge". В качестве разделителя элементов считается `,` 
3. RocksDbArraysDao - аналогично RocksDbCollectionDao, но оперирует Java массивами 
4. RocksDbValueDao - предназначен для хранения ADK Value

Имеется два режима хранения ADK Value:

1. В виде `ProtobufValue`. В этом случае мы храним в одной "ячейке" набор протобайт, который получили из Value. 
В конечном итоге для изменения сущности нам понадобится "вытащить" из роксы всю сущность, после поменять поля и положить её обратно. Данный формат оптимален для тех случаев, когда сущности читаются чаще, чем обновляются. 
2. Каждое поле сущности хранится в отдельной ячейке со своим ключом. Ключ формируется по принципу
`entity:id:field` 
В данном случае для изменения сущности нам достаточно обновить конкретное поле в конкретной ячейке, не затрагивая остальные. Данный формат оптимален для тех случаев, когда сущности часто обновляются. 


## Основная функция модуля:
Развертка RocksDb и предоставление к ней удобного API 

## Особености конфигурации модуля
Отдельно в конфигурации стоит отметить путь до RocksDb:
```
    String getRocksDbPath()
```

Физически RocksDb представляет собой набор обновляемых файлов внутри определенной директории.
Один модуль в один момент времени может работать с одной директорией.
Соответственно, для каждого модуля директорию нужно выбирать грамотно.
Задаётся директория как раз в конфигурации: `getRocksDbPath()`

В момент загрузки модуля происходит открытие данной директории.

В момент выгрузки - ресурс работы с роксой очищается. 



## Что почитать
[RocksDB](https://rocksdb.org/)

[RocksDB GitHub](https://github.com/facebook/rocksdb)